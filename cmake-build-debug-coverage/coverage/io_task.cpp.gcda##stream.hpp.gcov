        -:    0:Source:/home/df/Documents/workspace/async_runtime/include/ar/stream.hpp
        -:    0:Graph:/home/df/Documents/workspace/async_runtime/cmake-build-debug-coverage/CMakeFiles/ar.dir/src/io_task.cpp.gcno
        -:    0:Data:/home/df/Documents/workspace/async_runtime/cmake-build-debug-coverage/CMakeFiles/ar.dir/src/io_task.cpp.gcda
        -:    0:Runs:1
        -:    1:#ifndef AR_STREAM_HPP
        -:    2:#define AR_STREAM_HPP
        -:    3:
        -:    4:
        -:    5:#include "ar/task.hpp"
        -:    6:#include "uv.h"
        -:    7:
        -:    8:
        -:    9:#ifdef USE_TESTS
        -:   10:class STREAM_TEST_FRIEND;
        -:   11:#endif
        -:   12:
        -:   13:
        -:   14:namespace AsyncRuntime {
        -:   15:
        -:   16:    /**
        -:   17:     * @brief i/o file stream
        -:   18:     * @class IOFsStream
        -:   19:     */
        -:   20:    class IOStream {
        -:   21:        friend class Task;
        -:   22:
        -:   23:#ifdef USE_TESTS
        -:   24:        friend STREAM_TEST_FRIEND;
        -:   25:#endif
        -:   26:
        -:   27:    public:
        -:   28:        enum Mode { W,R };
        -:   29:
        -:   30:
        -:   31:        IOStream();
        -:   32:        IOStream(const char* buf, int64_t len);
        -:   33:        ~IOStream();
        -:   34:
        -:   35:
        -:   36:        void Flush();
        -:   37:
        -:   38:
        -:   39:        /**
        -:   40:         * @brief set file descriptor
        -:   41:         * @param file - file descriptor
        -:   42:         */
function _ZN12AsyncRuntime8IOStream5SetFdEi called 0 returned 0% blocks executed 0%
    #####:   43:        void SetFd(uv_file file) { fd = file; }
        -:   44:
        -:   45:
        -:   46:        /**
        -:   47:         * @brief
        -:   48:         * @param mode
        -:   49:         */
        -:   50:        void SetMode(const Mode& mode);
        -:   51:
        -:   52:
        -:   53:        /**
        -:   54:         * @brief get file descriptor
        -:   55:         * @return file descriptor
        -:   56:         */
function _ZNK12AsyncRuntime8IOStream5GetFdEv called 0 returned 0% blocks executed 0%
    #####:   57:        uv_file GetFd() const { return fd; }
    %%%%%:   57-block  0
        -:   58:
        -:   59:
        -:   60:        /**
        -:   61:         * @brief
        -:   62:         * @param size
        -:   63:         * @return
        -:   64:         */
        -:   65:        uv_buf_t* Next(int64_t size = 1024);
        -:   66:        bool Next(uv_buf_t* buf, int64_t size = 1024);
        -:   67:        void Begin();
        -:   68:
        -:   69:
        -:   70:        /**
        -:   71:         * @brief get size of current read buffer
        -:   72:         * @return
        -:   73:         */
function _ZNK12AsyncRuntime8IOStream13GetBufferSizeEv called 0 returned 0% blocks executed 0%
    #####:   74:        int64_t GetBufferSize() const { return length; };
    %%%%%:   74-block  0
        -:   75:        const char* GetBuffer() const { return buffer; };
        -:   76:
        -:   77:
        -:   78:        friend void FsReadCb(uv_fs_s* req);
        -:   79:        friend void NetReadCb(uv_stream_t *stream, ssize_t nread, const uv_buf_t *buf);
        -:   80:    private:
        -:   81:        uv_file                 fd;
        -:   82:        int64_t                 seek = 0;
        -:   83:        int64_t                 length = 0;
        -:   84:        int64_t                 allocated_length = 0;
        -:   85:        char*                   buffer = nullptr;
        -:   86:        bool                    allocated = false;
        -:   87:        uv_buf_t                uv_buf;
        -:   88:    };
        -:   89:
        -:   90:    typedef std::shared_ptr<IOStream>     IOStreamPtr;
        -:   91:
        -:   92:
        -:   93:    inline IOStreamPtr MakeStream() {
        -:   94:        return std::make_shared<IOStream>();
        -:   95:    }
        -:   96:
        -:   97:
        -:   98:    inline IOStreamPtr MakeStream(const char *buffer, size_t length) {
        -:   99:        return std::make_shared<IOStream>(buffer, length);
        -:  100:    }
        -:  101:}
        -:  102:
        -:  103:#endif //AR_STREAM_HPP
